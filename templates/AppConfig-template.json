{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "SubscriptionId": {
            "type": "string",
            "defaultValue": "",
            "metadata": {
                "description": "Subscription ID of the resource emitting the metric that will be used for the comparison."
            }
        },
        "ResourceGroupName": {
            "type": "string",
            "defaultValue": "",
            "metadata": {
                "description": "Resource Group of the Resource emitting the metric that will be used for the comparison."
            }
        },
		 "AppConfigurationName": {
            "defaultValue": "",
            "type": "String",
			 "metadata": {
                "description": "Application Configuration Name"
            }
        },
        "virtualNetwork": {
            "defaultValue": "/subscriptions/xxx/resourceGroups/xxx/providers/Microsoft.Network/virtualNetworks/xxx",
            "type": "String",
			 "metadata": {
                "description": "VNET Id"
            }
        },
		"subnet": {
		   "defaultValue": "xxx",
		  "type": "String",
		  "metadata": {
			"description": "Subnet Name"
        }
    }
    },
    "variables": { 
        "configurationStores": "[concat('/subscriptions/', parameters('SubscriptionId'),'/ResourceGroups/', parameters('ResourceGroupName'),'/providers/Microsoft.AppConfiguration/configurationStores/',parameters('AppConfigurationName'))]",
		"privateEndpoints_name": "[concat(parameters('AppConfigurationName'), 'pv')]"
	},
    "resources": [
	  {
            "type": "Microsoft.AppConfiguration/configurationStores",
            "apiVersion": "2021-10-01-preview",
            "name": "[parameters('AppConfigurationName')]",
            "location": "southindia",
            "sku": {
                "name": "standard"
            },
            "properties": {
                "encryption": {},
                "publicNetworkAccess": "Disabled",
                "disableLocalAuth": false,
                "softDeleteRetentionInDays": 7,
                "enablePurgeProtection": false
            }
        },
        {
            "type": "Microsoft.Network/privateEndpoints",
            "apiVersion": "2020-11-01",
            "name": "[variables('privateEndpoints_name')]",
            "location": "southindia",
            "properties": {
                "privateLinkServiceConnections": [
                    {
                        "name": "[variables('privateEndpoints_name')]",
                        "properties": {
                            "privateLinkServiceId": "[variables('configurationStores')]",
                            "groupIds": [
                                "configurationStores"
                            ],
                            "privateLinkServiceConnectionState": {
                                "status": "Approved",
                                "description": "Auto-Approved",
                                "actionsRequired": "None"
                            }
                        }
                    }
                ],
                "manualPrivateLinkServiceConnections": [],
                "subnet": {
                    "id": "[concat(parameters('virtualNetwork'), '/subnets/', parameters('subnet'))]"
                },
                "customDnsConfigs": []
            },
			 "dependsOn": [
                "[resourceId('Microsoft.AppConfiguration/configurationStores', parameters('AppConfigurationName'))]"
            ]
        },
        {
            "type": "Microsoft.AppConfiguration/configurationStores/privateEndpointConnections",
            "apiVersion": "2021-10-01-preview",
             "name": "[concat(parameters('AppConfigurationName'), '/',variables('privateEndpoints_name'))]",
            "dependsOn": [
                "[resourceId('Microsoft.AppConfiguration/configurationStores', parameters('AppConfigurationName'))]",
				"[resourceId('Microsoft.Network/privateEndpoints', variables('privateEndpoints_name'))]"
            ],
            "properties": {
                "privateEndpoint": {
                    "id": "[variables('privateEndpoints_name')]"
                },
                "privateLinkServiceConnectionState": {
                    "status": "Approved",
                    "description": "Auto-Approved"
                }
            }
        }
    ]
}